<h1>Пошаговая инструкция по установке MSTest отдельно от MS VS 2010</h1/
<p>Иногда возникает необходимость запустить тесты Visual Studio 2010 на отдельном сервере (например build сервере). Однако M$ связали mstest и ms vs на столько сильно, что даже вытакскивание отдельных длл-лок не достаточно для запуска.</p>
<h1>Решение</h1>
<p>Для копирования необходимых dll-ок автором <a href="http://mindinthewater.blogspot.com/2011/02/executing-visual-studio-2010-unit-tests.html">оригинальной статьи </a>был написан батник. Так же в нем указано какой ключ реестра необходимо стянуть, но у меня из батника это не получилось - копировал regedit-ом.</p>
<pre>@echo off<br />setlocal<br />set here=%~dp0<br /><br />mkdir mstest<br />set targetfolder=%here%mstest<br /><br />set programs=%programfiles%<br />if exist "%programfiles(x86)%" set programs=%programfiles(x86)%<br />set vs2010="%programs%\\Microsoft Visual Studio 10.0"<br />set gac1="%windir%"\\assembly<br />set gac2="%windir%"\\Microsoft.NET\\assembly<br /><br />echo === Copying from Visual Studio 2010 install folder...<br />copy %vs2010%\\Common7\\IDE\\mstest* "%targetfolder%"<br />copy %vs2010%\\Common7\\IDE\\PrivateAssemblies\\Microsoft.VisualStudio.Quality* "%targetfolder%"<br /><br />echo === Copying from %gac1%...<br />pushd "%gac1%"<br />dir /s /b *.dll | findstr QualityTools | findstr 10.0.0.0 &gt; %here%tmp.filelist<br />popd<br />for /F "tokens=*" %%f in (tmp.filelist) DO copy "%%f" "%targetfolder%"<br /><br />echo === Copying from %gac2%...<br />pushd "%gac2%"<br />dir /s /b *.dll | findstr QualityTools | findstr 10.0.0.0 &gt; %here%tmp.filelist<br />popd<br />for /F "tokens=*" %%f in (tmp.filelist) DO copy "%%f" "%targetfolder%"<br /><br />del tmp.filelist<br /><br />echo === Exporting registry keys...<br />regedit.exe /e %targetfolder%\\mstest.reg HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\VisualStudio\\10.0\\EnterpriseTools\\QualityTools<br /><br />echo === Done. Check output for errors!<br />exit /b 0<br /></pre>
<p> </p>
<p>Естественно, на компьютере, с которого копируются dll-ки студия должна быть установлена Visual Studio.</p>
<p>В результате работы скрипта в каталоге будет создан подкаталог mstest со всеми необходимыми dll-ками и .reg файлом (ВНИМАНИЕ: как я уже говорил - у меня рег файл не создался). Полученную папку необходимо перенести на билд сервер, применить изменения в реестре, и можно запускать mstest командой</p>
<pre>mstest /noisolation /testcontainer:"path\\to\\testproject.dll"</pre>
<p class="post-body entry-content">PS: Возможны проблемы с лицензированием (так как студия все же платная), но если с лицензией проблемы нет, то данное решение позволяет уменьшить объем, занимаемый программами, необходимыми для тестов (студия какбэ довольно большая :) ).</p>
<h1>Полезные ссылки</h1>
<p><a href="http://mindinthewater.blogspot.com/2011/02/executing-visual-studio-2010-unit-tests.html">mindinthewater.blogspot.com</a> - оригинал статьи<a href="http://mindinthewater.blogspot.com/2011/02/executing-visual-studio-2010-unit-tests.html"><br /></a></p>
